<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>All Face Swap Submissions</title>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: #f4f7f9;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: auto;
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgb(0 0 0 / 0.1);
      }
      h1 {
        text-align: center;
        margin-bottom: 25px;
        color: #333;
        font-size: clamp(1.5rem, 4vw, 2.5rem);
      }
      .stats-bar {
        background-color: #e3f2fd;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 25px;
        display: flex;
        justify-content: center;
        gap: 30px;
        flex-wrap: wrap;
      }
      .stat-item {
        text-align: center;
      }
      .stat-number {
        font-size: clamp(1.4rem, 4vw, 1.8rem);
        font-weight: 700;
        color: #5271ff;
        display: block;
      }
      .stat-label {
        font-size: 0.9rem;
        color: #666;
      }
      .error-message {
        background-color: #ffe6e6;
        color: #d32f2f;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
      }
      .no-results {
        text-align: center;
        color: #777;
        padding: 40px;
        font-size: 1.1rem;
      }

      /* DESKTOP TABLE LAYOUT */
      .table-container {
        width: 100%;
        overflow-x: auto;
        margin-bottom: 25px;
        border-radius: 8px;
        border: 1px solid #ddd;
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
      }

      .desktop-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px; /* Ensures table doesn't compress too much */
        background: white;
      }

      .desktop-table th,
      .desktop-table td {
        border: 1px solid #ddd;
        padding: 12px 8px;
        text-align: center;
        vertical-align: middle;
      }

      .desktop-table th {
        background: #5271ff;
        color: white;
        font-weight: 600;
        position: sticky;
        top: 0;
        z-index: 10;
        white-space: nowrap;
      }

      .desktop-table td {
        font-size: 0.9rem;
        word-wrap: break-word;
      }

      .desktop-table tr:nth-child(even) {
        background-color: #f8f9fa;
      }

      /* MOBILE CARD LAYOUT */
      .mobile-cards {
        display: none;
      }

      .submission-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 12px;
        margin-bottom: 20px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .submission-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(82, 113, 255, 0.15);
        border-color: #5271ff;
      }

      .card-header {
        border-bottom: 2px solid #e3f2fd;
        padding-bottom: 15px;
        margin-bottom: 15px;
      }

      .card-name {
        color: #5271ff;
        font-size: 1.2rem;
        font-weight: 700;
        text-decoration: none;
        display: block;
        margin-bottom: 5px;
      }

      .card-name:hover {
        text-decoration: underline;
      }

      .card-date {
        color: #666;
        font-size: 0.9rem;
      }

      .card-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
      }

      .card-row:last-child {
        border-bottom: none;
      }

      .card-label {
        font-weight: 600;
        color: #333;
        font-size: 0.9rem;
        min-width: 80px;
      }

      .card-value {
        flex: 1;
        text-align: right;
        font-size: 0.9rem;
        color: #666;
      }

      /* Enhanced clickable submission rows */
      .submission-row {
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .submission-row:hover {
        background-color: #e3f2fd !important;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(82, 113, 255, 0.15);
      }

      .name-link {
        color: #5271ff;
        font-weight: 700;
        text-decoration: none;
        display: block;
        padding: 4px 0;
      }

      .name-link:hover {
        text-decoration: underline;
        color: #3a54d1;
      }

      .submission-preview {
        margin-top: 4px;
        opacity: 0;
        transition: opacity 0.3s ease;
        font-size: 0.75rem;
        color: #666;
      }

      .submission-row:hover .submission-preview {
        opacity: 1;
      }

      .email-link,
      .phone-link,
      .date-link {
        color: #333;
        text-decoration: none;
        display: block;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.3s ease;
      }

      .email-link:hover,
      .phone-link:hover,
      .date-link:hover {
        background-color: rgba(82, 113, 255, 0.1);
        color: #5271ff;
      }

      .action-buttons {
        display: flex;
        gap: 4px;
        flex-direction: column;
        align-items: center;
      }

      .view-btn {
        background: linear-gradient(135deg, #5271ff 0%, #667eea 100%);
        color: white;
        text-decoration: none;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-block;
        margin-bottom: 2px;
      }

      .view-btn:hover {
        background: linear-gradient(135deg, #3a54d1 0%, #5271ff 100%);
        transform: translateY(-1px);
      }

      .download-link {
        color: #28a745;
        text-decoration: none;
        font-weight: 600;
        padding: 4px 8px;
        border-radius: 4px;
        display: inline-block;
        transition: background-color 0.3s ease;
        position: relative;
        z-index: 10;
      }

      .download-link:hover {
        background-color: #28a745;
        color: white;
      }

      .view-link {
        color: #666;
        text-decoration: none;
        font-style: italic;
      }

      .view-link:hover {
        color: #5271ff;
        text-decoration: underline;
      }

      nav.pagination {
        text-align: center;
        margin-top: 20px;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 5px;
      }

      nav.pagination a,
      nav.pagination span {
        padding: 8px 16px;
        border: 2px solid #5271ff;
        border-radius: 8px;
        color: #5271ff;
        text-decoration: none;
        cursor: pointer;
        font-weight: 600;
        display: inline-block;
        transition: all 0.3s ease;
      }

      nav.pagination a:hover,
      nav.pagination span.active {
        background-color: #5271ff;
        color: white;
      }

      nav.pagination span.disabled {
        border-color: #ccc;
        color: #ccc;
        cursor: not-allowed;
      }

      .actions {
        text-align: center;
        margin-bottom: 20px;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
      }

      .btn {
        background-color: #5271ff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        display: inline-block;
        transition: background-color 0.3s ease;
      }

      .btn:hover {
        background-color: #3a54d1;
      }

      /* Universal Navigation Styles */
      .app-navigation {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 0;
        margin: -20px -20px 30px -20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        flex-wrap: wrap;
      }

      .nav-brand {
        display: flex;
        align-items: center;
        gap: 10px;
        color: white;
        font-weight: 700;
        font-size: 1.2rem;
      }

      .nav-logo {
        font-size: 1.8rem;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }

      .nav-links {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }

      .nav-link {
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        white-space: nowrap;
      }

      .nav-link:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        transform: translateY(-1px);
      }

      .nav-link.active {
        background: rgba(255, 255, 255, 0.25);
        color: white;
        border-color: rgba(255, 255, 255, 0.3);
      }

      /* RESPONSIVE BREAKPOINTS */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 20px 15px;
        }

        /* Hide desktop table, show mobile cards */
        .desktop-table {
          display: none;
        }

        .mobile-cards {
          display: block;
        }

        .nav-container {
          flex-direction: column;
          gap: 15px;
          padding: 15px;
        }

        .nav-links {
          justify-content: center;
          gap: 6px;
        }

        .nav-link {
          padding: 6px 12px;
          font-size: 0.8rem;
        }

        .stats-bar {
          gap: 15px;
          padding: 15px 10px;
        }

        .actions {
          flex-direction: column;
          align-items: center;
        }

        .btn {
          width: 100%;
          max-width: 300px;
        }

        nav.pagination {
          flex-direction: column;
          gap: 10px;
        }

        nav.pagination a,
        nav.pagination span {
          width: 100%;
          max-width: 200px;
          margin: 0 auto;
        }
      }

      @media (max-width: 480px) {
        .card-row {
          flex-direction: column;
          align-items: flex-start;
          gap: 5px;
        }

        .card-value {
          text-align: left;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Universal Navigation Header -->
      <div class="app-navigation">
        <div class="nav-container">
          <div class="nav-brand">
            <span class="nav-logo">🎭</span>
            <span class="nav-title">Face Swap Pro</span>
          </div>

          <nav class="nav-links">
            <a
              href="/"
              class="nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'home' ? 'active' : '' %>"
            >
              🏠 Create Face Swap
            </a>
            <a
              href="/submissions"
              class="nav-link <%= typeof currentPage !== 'undefined' && currentPage === 'submissions' ? 'active' : '' %>"
            >
              📊 View All Submissions
            </a>
            <% if (typeof submission !== 'undefined' && submission &&
            submission._id) { %>
            <a
              href="/submissions/<%= submission._id %>"
              class="nav-link active"
            >
              📋 Current Details
            </a>
            <% } %>
            <a href="/admin/status" class="nav-link"> 🔧 API Status </a>
          </nav>
        </div>
      </div>

      <h1>📊 Face Swap Submissions</h1>

      <!-- Error checking -->
      <% if (typeof error !== 'undefined' && error) { %>
      <div class="error-message">⚠️ <%= error %></div>
      <% } %>

      <!-- Stats checking -->
      <% if (typeof stats !== 'undefined' && stats) { %>
      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-number"><%= stats.total || 0 %></span>
          <span class="stat-label">Total Submissions</span>
        </div>
        <div class="stat-item">
          <span class="stat-number"><%= stats.today || 0 %></span>
          <span class="stat-label">Today</span>
        </div>
        <div class="stat-item">
          <span class="stat-number"
            ><%= typeof submissions !== 'undefined' ? submissions.length : 0
            %></span
          >
          <span class="stat-label">Showing</span>
        </div>
      </div>
      <% } %>

      <div class="actions">
        <a href="/" class="btn">➕ Create New Submission</a>
        <a href="/admin/status" class="btn">🔧 API Status</a>
      </div>

      <!-- Submissions checking -->
      <% if (typeof submissions === 'undefined' || !submissions ||
      submissions.length === 0) { %>
      <div class="no-results">
        <p>📭 No submissions found.</p>
        <a href="/" class="btn">Create First Submission</a>
      </div>
      <% } else { %>

      <!-- DESKTOP TABLE VIEW -->
      <div class="table-container">
        <table class="desktop-table">
          <thead>
            <tr>
              <th style="width: 15%">👤 Name</th>
              <th style="width: 20%">📧 Email</th>
              <th style="width: 12%">📱 Phone</th>
              <th style="width: 12%">📸 Source</th>
              <th style="width: 12%">🎭 Target</th>
              <th style="width: 12%">✨ Result</th>
              <th style="width: 17%">📅 Date</th>
            </tr>
          </thead>
          <tbody>
            <% submissions.forEach(sub => { %>
            <tr class="submission-row" data-href="/submissions/<%= sub._id %>">
              <td>
                <a href="/submissions/<%= sub._id %>" class="name-link">
                  <strong><%= sub.name %></strong>
                </a>
                <div class="submission-preview">
                  <small>📋 Click to view full details</small>
                </div>
              </td>
              <td>
                <a href="/submissions/<%= sub._id %>" class="email-link">
                  <%= sub.email %>
                </a>
              </td>
              <td>
                <a href="/submissions/<%= sub._id %>" class="phone-link">
                  <%= sub.phone %>
                </a>
              </td>
              <td>
                <% if (sub.sourceImage && sub.sourceImage.url) { %>
                <div class="action-buttons">
                  <a
                    href="/submissions/<%= sub._id %>"
                    class="view-btn"
                    title="View Details"
                  >
                    👁️ View
                  </a>
                  <a
                    href="/download/<%= sub._id %>/source"
                    class="download-link"
                    onclick="event.stopPropagation();"
                  >
                    📥 Download
                  </a>
                </div>
                <% } else { %>
                <a href="/submissions/<%= sub._id %>" class="view-link">
                  <span style="color: #999">N/A - View Details</span>
                </a>
                <% } %>
              </td>
              <td>
                <% if (sub.targetImage && sub.targetImage.url) { %>
                <div class="action-buttons">
                  <a
                    href="/submissions/<%= sub._id %>"
                    class="view-btn"
                    title="View Details"
                  >
                    👁️ View
                  </a>
                  <a
                    href="/download/<%= sub._id %>/target"
                    class="download-link"
                    onclick="event.stopPropagation();"
                  >
                    📥 Download
                  </a>
                </div>
                <% } else { %>
                <a href="/submissions/<%= sub._id %>" class="view-link">
                  <span style="color: #999">N/A - View Details</span>
                </a>
                <% } %>
              </td>
              <td>
                <% if (sub.swappedImage && sub.swappedImage.url) { %>
                <div class="action-buttons">
                  <a
                    href="/submissions/<%= sub._id %>"
                    class="view-btn"
                    title="View Details"
                  >
                    👁️ View
                  </a>
                  <a
                    href="/download/<%= sub._id %>/swapped"
                    class="download-link"
                    onclick="event.stopPropagation();"
                  >
                    📥 Download
                  </a>
                </div>
                <% } else { %>
                <a href="/submissions/<%= sub._id %>" class="view-link">
                  <span style="color: #999">Processing - View Details</span>
                </a>
                <% } %>
              </td>
              <td>
                <a href="/submissions/<%= sub._id %>" class="date-link">
                  <%= new Date(sub.createdAt).toLocaleDateString() %><br />
                  <small
                    ><%= new Date(sub.createdAt).toLocaleTimeString() %></small
                  >
                </a>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <!-- MOBILE CARD VIEW -->
      <div class="mobile-cards">
        <% submissions.forEach(sub => { %>
        <div
          class="submission-card"
          onclick="window.location.href='/submissions/<%= sub._id %>'"
        >
          <div class="card-header">
            <a href="/submissions/<%= sub._id %>" class="card-name">
              <%= sub.name %>
            </a>
            <div class="card-date">
              📅 <%= new Date(sub.createdAt).toLocaleDateString() %> • <%= new
              Date(sub.createdAt).toLocaleTimeString() %>
            </div>
          </div>

          <div class="card-row">
            <span class="card-label">📧 Email:</span>
            <span class="card-value"><%= sub.email %></span>
          </div>

          <div class="card-row">
            <span class="card-label">📱 Phone:</span>
            <span class="card-value"><%= sub.phone %></span>
          </div>

          <div class="card-row">
            <span class="card-label">📸 Source:</span>
            <span class="card-value">
              <% if (sub.sourceImage && sub.sourceImage.url) { %>
              <a
                href="/download/<%= sub._id %>/source"
                class="download-link"
                onclick="event.stopPropagation();"
              >
                📥 Download
              </a>
              <% } else { %>
              <span style="color: #999">N/A</span>
              <% } %>
            </span>
          </div>

          <div class="card-row">
            <span class="card-label">🎭 Target:</span>
            <span class="card-value">
              <% if (sub.targetImage && sub.targetImage.url) { %>
              <a
                href="/download/<%= sub._id %>/target"
                class="download-link"
                onclick="event.stopPropagation();"
              >
                📥 Download
              </a>
              <% } else { %>
              <span style="color: #999">N/A</span>
              <% } %>
            </span>
          </div>

          <div class="card-row">
            <span class="card-label">✨ Result:</span>
            <span class="card-value">
              <% if (sub.swappedImage && sub.swappedImage.url) { %>
              <a
                href="/download/<%= sub._id %>/swapped"
                class="download-link"
                onclick="event.stopPropagation();"
              >
                📥 Download
              </a>
              <% } else { %>
              <span style="color: #999">Processing...</span>
              <% } %>
            </span>
          </div>
        </div>
        <% }) %>
      </div>
      <% } %>

      <nav class="pagination" aria-label="Submissions Pagination">
        <% if (typeof hasPrevPage !== 'undefined' && hasPrevPage) { %>
        <a href="/submissions?page=<%= prevPage %>">&larr; Previous</a>
        <% } else { %>
        <span class="disabled">&larr; Previous</span>
        <% } %>

        <span class="active"
          >Page <%= typeof currentPage !== 'undefined' ? currentPage : 1
          %></span
        >

        <% if (typeof hasNextPage !== 'undefined' && hasNextPage) { %>
        <a href="/submissions?page=<%= nextPage %>">Next &rarr;</a>
        <% } else { %>
        <span class="disabled">Next &rarr;</span>
        <% } %>
      </nav>
    </div>

    <!-- Enhanced JavaScript for row clicking -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Make entire table rows clickable (desktop)
        const submissionRows = document.querySelectorAll(".submission-row");

        submissionRows.forEach((row) => {
          const href = row.getAttribute("data-href");

          row.addEventListener("click", function (e) {
            if (e.target.closest(".download-link")) {
              return;
            }

            if (href) {
              window.location.href = href;
            }
          });
        });

        // Add keyboard navigation
        submissionRows.forEach((row) => {
          row.addEventListener("keypress", function (e) {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              const href = row.getAttribute("data-href");
              if (href) {
                window.location.href = href;
              }
            }
          });

          row.setAttribute("tabindex", "0");
        });
      });
    </script>
  </body>
</html>
